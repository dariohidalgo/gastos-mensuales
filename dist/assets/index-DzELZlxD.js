import{j as e,r as a}from"./react-CtW5r0F0.js";import{c as H}from"./react-dom-CoD-mNjq.js";import{B as W}from"./react-router-dom-CSK1S-1I.js";import"./firebase-Dmqf4dop.js";import{i as Q,g as X,a as Z,G as ee,s as te,q as U,c as G,b as B,T as se,d as z,e as k,f as ae,o as V,h as ne}from"./@firebase-GS6PLQ4I.js";import{u as O,a as re,b as R,N as le}from"./react-router-DZm7uZHo.js";/* empty css                  */import"./scheduler-CzFDRTuY.js";import"./@remix-run-C0MJ9PeH.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))d(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const p of l.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&d(p)}).observe(document,{childList:!0,subtree:!0});function x(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function d(s){if(s.ep)return;s.ep=!0;const l=x(s);fetch(s.href,l)}})();const oe={apiKey:"AIzaSyCqkgutqaofo2LOGpNnAurawoP21IrMicY",authDomain:"gastos-66dbe.firebaseapp.com",projectId:"gastos-66dbe",storageBucket:"gastos-66dbe.appspot.com",messagingSenderId:"1092119604551",appId:"1:1092119604551:web:032ce6a8cb110fec04f062"},J=Q(oe),M=X(J),C=Z(J),ce=new ee,ie=()=>{const i=O(),m=async()=>{try{const d=(await te(M,ce)).user;d&&["dhidalgo651@gmail.com","voosdani@gmail.com"].includes(d.email)?i("/expenses"):(alert("Correo electrónico no autorizado."),M.signOut())}catch(x){console.error("Error durante el inicio de sesión:",x),alert("Error durante el inicio de sesión. Por favor, inténtalo de nuevo.")}};return e.jsx("div",{className:"login d-flex justify-content-center align-items-center vh-100",children:e.jsxs("div",{className:"col-10 col-sm-8 col-md-6 col-lg-4 d-flex flex-column align-items-center",children:[e.jsx("h2",{className:"titulo mb-4 text-center",children:"Bienvenido a la Aplicación de Gastos"}),e.jsx("button",{className:"btn btn-primary",onClick:m,children:"Iniciar sesión con Google"})]})})},de=()=>e.jsx("div",{className:"container d-flex justify-content-center",children:e.jsx("div",{className:" justify-content-md-end mt-3",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>window.location.href="/credit-expenses",children:"Ver Gastos de Tarjeta"})})}),me=()=>{const[i,m]=a.useState([]),[x,d]=a.useState([]),[s,l]=a.useState(0),[p,A]=a.useState(0),[D,P]=a.useState(0),[N,T]=a.useState(""),[E,F]=a.useState(new Date().getFullYear());a.useEffect(()=>{(async()=>{const h=U(G(C,"expenses")),f=(await B(h)).docs.map(g=>{const c=g.data(),I=c.createdAt instanceof se?c.createdAt.toDate():new Date;return{id:g.id,amount:c.amount,type:c.type,category:c.category,description:c.description||"",installments:c.installments,createdAt:I,userName:c.userName||""}});m(f),d(f)})()},[]),a.useEffect(()=>{(()=>{if(N&&E){const h=i.filter(c=>{const I=new Date(c.createdAt);return I.getMonth()+1===parseInt(N)&&I.getFullYear()===E});d(h);let j=0,f=0,g=0;h.forEach(c=>{c.type==="Ingresos"?j+=c.amount:c.type==="Tarjeta de Credito"?f+=c.amount:c.type==="Gastos"&&(g+=c.amount)}),l(j),A(f),P(g)}else d(i)})()},[N,E,i]);const v=async n=>{if(window.confirm("¿Estás seguro de que deseas eliminar este gasto?"))try{await z(k(C,"expenses",n)),m(j=>j.filter(f=>f.id!==n)),d(j=>j.filter(f=>f.id!==n))}catch(j){console.error("Error al eliminar el documento: ",j)}},Y=n=>{T(n.target.value)},y=n=>{F(parseInt(n.target.value))};return e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"row mb-4 d-flex justify-content-center",children:[e.jsxs("div",{className:"col-md-3 text-center",children:[e.jsx("label",{htmlFor:"monthFilter",className:"form-label",children:"Filtrar por mes:"}),e.jsxs("select",{id:"monthFilter",className:"form-select",value:N,onChange:Y,children:[e.jsx("option",{value:"",children:"Todos los meses"}),e.jsx("option",{value:"1",children:"Enero"}),e.jsx("option",{value:"2",children:"Febrero"}),e.jsx("option",{value:"3",children:"Marzo"}),e.jsx("option",{value:"4",children:"Abril"}),e.jsx("option",{value:"5",children:"Mayo"}),e.jsx("option",{value:"6",children:"Junio"}),e.jsx("option",{value:"7",children:"Julio"}),e.jsx("option",{value:"8",children:"Agosto"}),e.jsx("option",{value:"9",children:"Septiembre"}),e.jsx("option",{value:"10",children:"Octubre"}),e.jsx("option",{value:"11",children:"Noviembre"}),e.jsx("option",{value:"12",children:"Diciembre"})]})]}),e.jsxs("div",{className:"col-md-3 text-center",children:[e.jsx("label",{htmlFor:"yearFilter",className:"form-label",children:"Filtrar por año:"}),e.jsx("select",{id:"yearFilter",className:"form-select",value:E,onChange:y,children:[...Array(5)].map((n,h)=>e.jsx("option",{value:new Date().getFullYear()-h,children:new Date().getFullYear()-h},h))})]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card text-center",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Total de Ingresos"}),e.jsxs("p",{className:"card-text",children:["$",s.toFixed(2)]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card text-center",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Deuda total de tarjeta de crédito"}),e.jsxs("p",{className:"card-text",children:["$",p.toFixed(2)]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card text-center",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Gastos fijos totales"}),e.jsxs("p",{className:"card-text",children:["$",D.toFixed(2)]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card text-center",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Monto restante"}),e.jsxs("p",{className:"card-text",children:["$",(s-p-D).toFixed(2)]})]})})})]}),e.jsx("h3",{className:"mb-3",children:"Transacciones filtradas:"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Monto"}),e.jsx("th",{className:"d-none d-sm-table-cell",children:"Categoría"}),e.jsx("th",{className:"d-none d-md-table-cell",children:"Descripción"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{className:"d-none d-lg-table-cell",children:"Usuario"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:x.map((n,h)=>e.jsxs("tr",{children:[e.jsx("td",{children:n.type==="Tarjeta de Credito"?"Tarjeta de crédito":n.type==="Gastos"?"Gasto":"Ingreso"}),e.jsxs("td",{children:["$",n.amount.toFixed(2)]}),e.jsx("td",{className:"d-none d-sm-table-cell",children:n.category}),e.jsx("td",{className:"d-none d-md-table-cell",children:n.description}),e.jsx("td",{children:n.createdAt.toLocaleDateString()}),e.jsx("td",{className:"d-none d-lg-table-cell",children:n.userName}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>v(n.id),children:"Eliminar"})})]},h))})]})})]})},he=({onTotalsUpdate:i})=>{const m=O(),[x,d]=a.useState(""),[s,l]=a.useState(""),[p,A]=a.useState(""),[D,P]=a.useState(""),[N,T]=a.useState(1),E=new Date().getMonth(),F=new Date().getFullYear(),[v,Y]=a.useState(E+1),[y,n]=a.useState(F),[h,j]=a.useState([]),[f,g]=a.useState([]);a.useEffect(()=>{(async()=>{const r=U(G(C,"creditCardExpenses")),u=(await B(r)).docs.map(b=>{const S=b.data();return{id:b.id,...S}});j(u),g(u)})()},[]);const c=async t=>{t.preventDefault();try{const o={id:(await ae(G(C,"creditCardExpenses"),{date:x,transactionDetail:s,amountInPesos:parseFloat(p),amountInDollars:parseFloat(D)||0,installments:N})).id,date:x,transactionDetail:s,amountInPesos:parseFloat(p),amountInDollars:parseFloat(D)||0,installments:N};j(u=>[...u,o]),g(u=>[...u,o]),d(""),l(""),A(""),P(""),T(1)}catch(r){console.error("Error al agregar el gasto: ",r)}};a.useEffect(()=>{if(v&&y){const r=h.flatMap(o=>{const u=new Date(o.date),b=u.getMonth()+1,S=u.getFullYear(),q=v,w=y;if(isNaN(q)||isNaN(b))return console.error("Error: Mes seleccionado o índice de mes es NaN"),[];const L=(w-S)*12+(q-(b+1));if(L>=0&&L<o.installments){const _=o.installments-L;return{...o,remainingInstallments:_}}else return[]});g(r)}else g(h);const t={};h.forEach(r=>{const o=new Date(r.date),u=r.amountInPesos/r.installments;for(let b=0;b<r.installments;b++){const S=(o.getMonth()+b+1)%12,w=`${o.getFullYear()+Math.floor((o.getMonth()+b+1)/12)}-${(S||12).toString().padStart(2,"0")}`;t[w]||(t[w]=0),t[w]+=u}}),i(t)},[v,y,h]);const I=async t=>{if(!(!t||!window.confirm("¿Estás seguro de que deseas eliminar este gasto?")))try{await z(k(C,"creditCardExpenses",t)),j(o=>o.filter(u=>u.id!==t)),g(o=>o.filter(u=>u.id!==t))}catch(o){console.error("Error al eliminar el gasto: ",o)}},K=f.reduce((t,r)=>t+r.amountInPesos/r.installments,0);return e.jsxs("div",{className:"container",children:[e.jsxs("form",{className:"row justify-content-center align-items-center m-3",onSubmit:c,children:[e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"date",children:"Fecha:"}),e.jsx("input",{className:"form-control",type:"date",id:"date",value:x,onChange:t=>d(t.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"mb-2",htmlFor:"transactionDetail",children:"Detalle de Transacción:"}),e.jsx("input",{className:"form-control",type:"text",id:"transactionDetail",placeholder:"Detalle",value:s,onChange:t=>l(t.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"amountInPesos",children:"Monto en Pesos:"}),e.jsx("input",{className:"form-control",type:"number",id:"amountInPesos",placeholder:"Pesos",value:p,onChange:t=>A(t.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"amountInDollars",children:"Monto en Dólares:"}),e.jsx("input",{className:"form-control",type:"number",id:"amountInDollars",placeholder:"Dólares",value:D,onChange:t=>P(t.target.value)})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"installments",children:"Cuotas:"}),e.jsx("input",{className:"form-control",type:"number",id:"installments",min:"1",value:N,onChange:t=>T(parseInt(t.target.value)),required:!0})]}),e.jsx("div",{className:"col-md-2 d-flex justify-content-center mt-3",children:e.jsx("button",{className:"btn btn-success btn-lg",type:"submit",children:"Enviar"})}),e.jsx("div",{className:"col-md-2 d-flex justify-content-center mt-3",children:e.jsx("button",{className:"btn btn-primary btn-lg",onClick:()=>m("/expenses"),children:"Volver"})})]}),e.jsxs("div",{className:"row mb-4 d-flex justify-content-center",children:[e.jsxs("div",{className:"col-md-2 text-center",children:[e.jsx("label",{htmlFor:"monthFilter",className:"form-label",children:"Filtrar por mes:"}),e.jsx("select",{id:"monthFilter",className:"form-select",value:v,onChange:t=>Y(parseInt(t.target.value)),children:[...Array(12)].map((t,r)=>e.jsx("option",{value:r+1,children:new Date(0,r).toLocaleString("es-ES",{month:"long"})},r+1))})]}),e.jsxs("div",{className:"col-md-2 text-center",children:[e.jsx("label",{htmlFor:"yearFilter",className:"form-label",children:"Filtrar por año:"}),e.jsxs("select",{id:"yearFilter",className:"form-select",value:y,onChange:t=>n(parseInt(t.target.value)),children:[e.jsx("option",{value:F,children:F}),e.jsx("option",{value:F+1,children:F+1})]})]})]}),e.jsxs("h3",{className:"mb-3",children:["Gastos de Tarjeta de Crédito -"," ",new Date(0,v-1).toLocaleString("es-ES",{month:"long"})," ",y]}),e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Detalle"}),e.jsx("th",{children:"Monto (Pesos)"}),e.jsx("th",{children:"Monto (Dólares)"}),e.jsx("th",{children:"Cuotas Restantes"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:f.map(t=>{const r=t.amountInPesos/t.installments,o=t.amountInDollars?t.amountInDollars/t.installments:0;return e.jsxs("tr",{children:[e.jsx("td",{children:t.date}),e.jsx("td",{children:t.transactionDetail}),e.jsxs("td",{children:["$",r.toFixed(2)]}),e.jsxs("td",{children:["$",o.toFixed(2)]}),e.jsx("td",{children:t.installments}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>I(t.id),children:"Eliminar"})})]},t.id)})})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsxs("h4",{children:["Total a pagar en"," ",new Date(0,v-1).toLocaleString("es-ES",{month:"long"})," ",y,": $",K.toFixed(2)]})})]})},ue=()=>{const[i,m]=a.useState(null),x=O();a.useEffect(()=>{const s=V(M,l=>{m(l)});return()=>s()},[]);const d=async()=>{try{await ne(M),x("/")}catch(s){console.error("Error al cerrar sesión: ",s)}};return i?e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"10px"},children:[i.photoURL&&e.jsx("img",{src:i.photoURL,alt:"User Avatar",style:{width:40,height:40,borderRadius:"50%",marginRight:10}}),e.jsx("span",{children:i.displayName}),e.jsx("button",{className:"btn btn-danger btn-sm ms-3",onClick:d,children:"Cerrar Sesión"})]}):null},$=({children:i})=>{const[m,x]=a.useState(null),[d,s]=a.useState(!0);return a.useEffect(()=>{const l=V(M,p=>{x(p),s(!1)});return()=>l()},[]),d?null:m?e.jsx(e.Fragment,{children:i}):e.jsx(le,{to:"/"})},xe=()=>{const i=m=>{console.log("Totales actualizados:",m)};return e.jsx(W,{children:e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(ue,{}),e.jsx("h1",{className:"d-flex justify-content-center align-items-center",children:"Gastos Hidalgo Voos"}),e.jsxs(re,{children:[e.jsx(R,{path:"/",element:e.jsx(ie,{})}),e.jsx(R,{path:"/expenses",element:e.jsx($,{children:e.jsxs(e.Fragment,{children:[e.jsx(de,{}),e.jsx(me,{})]})})}),e.jsx(R,{path:"/credit-expenses",element:e.jsx($,{children:e.jsx(he,{onTotalsUpdate:i})})})]})]})})};H(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(xe,{})}));
