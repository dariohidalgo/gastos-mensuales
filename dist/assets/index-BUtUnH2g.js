import{j as e,r}from"./react-CtW5r0F0.js";import{c as X}from"./react-dom-CoD-mNjq.js";import{B as Z}from"./react-router-dom-CSK1S-1I.js";import"./firebase-SmtNWdoZ.js";import{i as ee,g as te,a as se,G as ne,s as ae,q as G,c as w,b as R,T as z,d as J,e as V,f as K,o as H,h as W}from"./@firebase-DgOjqIHO.js";import{u as B,a as re,b as $,N as oe}from"./react-router-DZm7uZHo.js";/* empty css                  */import"./scheduler-CzFDRTuY.js";import"./@remix-run-C0MJ9PeH.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))x(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const p of l.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&x(p)}).observe(document,{childList:!0,subtree:!0});function u(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function x(n){if(n.ep)return;n.ep=!0;const l=u(n);fetch(n.href,l)}})();const le={apiKey:"AIzaSyCqkgutqaofo2LOGpNnAurawoP21IrMicY",authDomain:"gastos-66dbe.firebaseapp.com",projectId:"gastos-66dbe",storageBucket:"gastos-66dbe.appspot.com",messagingSenderId:"1092119604551",appId:"1:1092119604551:web:032ce6a8cb110fec04f062"},_=ee(le),E=te(_),b=se(_),ce=new ne,ie=()=>{const d=B(),i=async()=>{try{const x=(await ae(E,ce)).user;x&&["dhidalgo651@gmail.com","voosdani@gmail.com"].includes(x.email)?d("/expenses"):(alert("Correo electrónico no autorizado."),E.signOut())}catch(u){console.error("Error durante el inicio de sesión:",u),alert("Error durante el inicio de sesión. Por favor, inténtalo de nuevo.")}};return e.jsx("div",{className:"login d-flex justify-content-center align-items-center vh-100",children:e.jsxs("div",{className:"col-10 col-sm-8 col-md-6 col-lg-4 d-flex flex-column align-items-center",children:[e.jsx("h2",{className:"titulo mb-4 text-center",children:"Bienvenido a la Aplicación de Gastos"}),e.jsx("button",{className:"btn btn-primary",onClick:i,children:"Iniciar sesión con Google"})]})})},de=()=>e.jsx("div",{className:"container d-flex justify-content-center",children:e.jsx("div",{className:" justify-content-md-end mt-3",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>window.location.href="/credit-expenses",children:"Ver Gastos de Tarjeta"})})}),me=(d,i,u)=>d.flatMap(n=>{const l=new Date(n.date),p=l.getMonth()+1,C=l.getFullYear(),f=(u-C)*12+(i-(p+1));return f>=0&&f<n.installments?n.amountInPesos/n.installments:0}).reduce((n,l)=>n+l,0),ue=()=>{const[d,i]=r.useState([]),[u,x]=r.useState([]),[n,l]=r.useState([]),[p,C]=r.useState(0),[f,P]=r.useState(0),[F,q]=r.useState(0),[y,S]=r.useState(""),[g]=r.useState(new Date().getFullYear()),[L,v]=r.useState(""),[M,D]=r.useState("Ingresos"),[I,A]=r.useState(""),[N,Y]=r.useState("");r.useEffect(()=>{const t=async()=>{const o=G(w(b,"expenses")),c=(await R(o)).docs.map(m=>{const j=m.data(),T=j.createdAt instanceof z?j.createdAt.toDate():new Date;return{id:m.id,...j,createdAt:T}});i(c)},a=async()=>{const o=G(w(b,"creditCardExpenses")),c=(await R(o)).docs.map(m=>{const j=m.data();return{id:m.id,...j}});l(c)};t(),a()},[]),r.useEffect(()=>{if(y){const t=d.filter(c=>{const m=c.createdAt.getMonth()+1,j=c.createdAt.getFullYear();return m===parseInt(y)&&j===new Date().getFullYear()}),a=t.filter(c=>c.type==="Ingresos").reduce((c,m)=>c+m.amount,0),o=t.filter(c=>c.type==="Gastos").reduce((c,m)=>c+m.amount,0),h=me(n,parseInt(y),g);x(t),C(a),P(h),q(o)}else x(d)},[y,g,d,n]);const U=t=>{const a=t.target.value;S(a)},O=async t=>{t.preventDefault();try{await J(w(b,"expenses"),{amount:parseFloat(L),type:M,category:I,description:N,createdAt:new Date,userName:"Usuario Actual",installments:M==="Tarjeta de Credito"?1:0}),v(""),D("Ingresos"),A(""),Y("");const a=G(w(b,"expenses")),h=(await R(a)).docs.map(c=>{const m=c.data(),j=m.createdAt instanceof z?m.createdAt.toDate():new Date;return{id:c.id,...m,createdAt:j}});i(h)}catch(a){console.error("Error al agregar el gasto: ",a)}},s=async t=>{if(window.confirm("Are you sure you want to delete this expense?"))try{await V(K(b,"expenses",t)),i(o=>o.filter(h=>h.id!==t))}catch(o){console.error("Error deleting document: ",o)}};return e.jsxs("div",{className:"container mt-4 ",children:[e.jsx("div",{className:"row mb-4 d-flex justify-content-center",children:e.jsxs("div",{className:"col-md-3 text-center",children:[e.jsx("label",{htmlFor:"monthFilter",className:"form-label",children:"Filtrar por mes:"}),e.jsxs("select",{id:"monthFilter",className:"form-select",value:y,onChange:U,children:[e.jsx("option",{value:"",children:"Todos los meses"}),e.jsx("option",{value:"1",children:"Enero"}),e.jsx("option",{value:"2",children:"Febrero"}),e.jsx("option",{value:"3",children:"Marzo"}),e.jsx("option",{value:"4",children:"Abril"}),e.jsx("option",{value:"5",children:"Mayo"}),e.jsx("option",{value:"6",children:"Junio"}),e.jsx("option",{value:"7",children:"Julio"}),e.jsx("option",{value:"8",children:"Agosto"}),e.jsx("option",{value:"9",children:"Septiembre"}),e.jsx("option",{value:"10",children:"Octubre"}),e.jsx("option",{value:"11",children:"Noviembre"}),e.jsx("option",{value:"12",children:"Diciembre"})]})]})}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card text-center",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Total de Ingresos"}),e.jsxs("p",{className:"card-text",children:["$",p.toLocaleString("es-ES")]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card text-center",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Deuda total de tarjeta de crédito"}),e.jsxs("p",{className:"card-text",children:["$",f.toLocaleString("es-ES")]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card text-center",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Gastos fijos totales"}),e.jsxs("p",{className:"card-text",children:["$",F.toLocaleString("es-ES")]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card text-center",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Monto restante"}),e.jsxs("p",{className:"card-text",children:["$",(p-f-F).toLocaleString("es-ES")]})]})})}),e.jsxs("form",{onSubmit:O,className:"row mb-4 mt-5 justify-content-center",children:[e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"number",className:"form-control",placeholder:"Monto",value:L,onChange:t=>v(t.target.value),required:!0})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:M,onChange:t=>D(t.target.value),children:[e.jsx("option",{value:"Ingresos",children:"Ingresos"}),e.jsx("option",{value:"Tarjeta de Credito",children:"Tarjeta de Crédito"}),e.jsx("option",{value:"Gastos",children:"Gastos"})]})}),e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Categoría",value:I,onChange:t=>A(t.target.value),required:!0})}),e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Descripción",value:N,onChange:t=>Y(t.target.value)})}),e.jsx("div",{className:"col-md-2",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Agregar Gasto"})})]})]}),e.jsx("h3",{className:"mb-3",children:"Todas las transacciones:"}),e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Monto"}),e.jsx("th",{children:"Categoría"}),e.jsx("th",{children:"Descripción"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Usuario"}),e.jsx("th",{children:"Cuotas"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:u.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.type==="Tarjeta de Credito"?"Tarjeta de crédito":t.type==="Gastos"?"Gasto":"Ingreso"}),e.jsxs("td",{children:["$",t.amount.toLocaleString("es-ES")]}),e.jsx("td",{children:t.category}),e.jsx("td",{children:t.description}),e.jsx("td",{children:t.createdAt.toLocaleDateString()}),e.jsx("td",{children:t.userName}),e.jsx("td",{children:t.type==="Tarjeta de Credito"?t.installments:"-"}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>s(t.id),children:"Eliminar"})})]},a))})]})]})},he=({onTotalsUpdate:d})=>{const i=B(),[u,x]=r.useState(""),[n,l]=r.useState(""),[p,C]=r.useState(""),[f,P]=r.useState(""),[F,q]=r.useState(1),y=new Date().getMonth(),S=new Date().getFullYear(),[g,L]=r.useState(y+1),[v,M]=r.useState(S),[D,I]=r.useState([]),[A,N]=r.useState([]);r.useEffect(()=>{(async()=>{const t=G(w(b,"creditCardExpenses")),o=(await R(t)).docs.map(h=>{const c=h.data();return{id:h.id,...c}});I(o),N(o)})()},[]);const Y=async s=>{s.preventDefault();try{const a={id:(await J(w(b,"creditCardExpenses"),{date:u,transactionDetail:n,amountInPesos:parseFloat(p),amountInDollars:parseFloat(f)||0,installments:F})).id,date:u,transactionDetail:n,amountInPesos:parseFloat(p),amountInDollars:parseFloat(f)||0,installments:F};I(o=>[...o,a]),N(o=>[...o,a]),x(""),l(""),C(""),P(""),q(1)}catch(t){console.error("Error al agregar el gasto: ",t)}};r.useEffect(()=>{if(g&&v){const t=D.flatMap(a=>{const o=new Date(a.date),h=o.getMonth()+1,c=o.getFullYear(),m=g,j=v;if(isNaN(m)||isNaN(h))return console.error("Error: Mes seleccionado o índice de mes es NaN"),[];const T=(j-c)*12+(m-(h+1));if(T>=0&&T<a.installments){const Q=a.installments-T;return{...a,remainingInstallments:Q}}else return[]});N(t)}else N(D);const s={};D.forEach(t=>{const a=new Date(t.date),o=t.amountInPesos/t.installments;for(let h=0;h<t.installments;h++){const c=(a.getMonth()+h+1)%12,j=`${a.getFullYear()+Math.floor((a.getMonth()+h+1)/12)}-${(c||12).toString().padStart(2,"0")}`;s[j]||(s[j]=0),s[j]+=o}}),d(s)},[g,v,D]);const U=async s=>{if(!(!s||!window.confirm("¿Estás seguro de que deseas eliminar este gasto?")))try{await V(K(b,"creditCardExpenses",s)),I(a=>a.filter(o=>o.id!==s)),N(a=>a.filter(o=>o.id!==s))}catch(a){console.error("Error al eliminar el gasto: ",a)}},O=A.reduce((s,t)=>s+t.amountInPesos/t.installments,0);return e.jsxs("div",{className:"container",children:[e.jsxs("form",{className:"row justify-content-center align-items-center m-3",onSubmit:Y,children:[e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"date",children:"Fecha:"}),e.jsx("input",{className:"form-control",type:"date",id:"date",value:u,onChange:s=>x(s.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"mb-2",htmlFor:"transactionDetail",children:"Detalle de Transacción:"}),e.jsx("input",{className:"form-control",type:"text",id:"transactionDetail",placeholder:"Detalle",value:n,onChange:s=>l(s.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"amountInPesos",children:"Monto en Pesos:"}),e.jsx("input",{className:"form-control",type:"number",id:"amountInPesos",placeholder:"Pesos",value:p,onChange:s=>C(s.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"amountInDollars",children:"Monto en Dólares:"}),e.jsx("input",{className:"form-control",type:"number",id:"amountInDollars",placeholder:"Dólares",value:f,onChange:s=>P(s.target.value)})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"installments",children:"Cuotas:"}),e.jsx("input",{className:"form-control",type:"number",id:"installments",min:"1",value:F,onChange:s=>q(parseInt(s.target.value)),required:!0})]}),e.jsx("div",{className:"col-md-2 d-flex justify-content-center mt-3",children:e.jsx("button",{className:"btn btn-success btn-lg",type:"submit",children:"Enviar"})}),e.jsx("div",{className:"col-md-2 d-flex justify-content-center mt-3",children:e.jsx("button",{className:"btn btn-primary btn-lg",onClick:()=>i("/expenses"),children:"Volver"})})]}),e.jsxs("div",{className:"row mb-4 d-flex justify-content-center",children:[e.jsxs("div",{className:"col-md-2 text-center",children:[e.jsx("label",{htmlFor:"monthFilter",className:"form-label",children:"Filtrar por mes:"}),e.jsx("select",{id:"monthFilter",className:"form-select",value:g,onChange:s=>L(parseInt(s.target.value)),children:[...Array(12)].map((s,t)=>e.jsx("option",{value:t+1,children:new Date(0,t).toLocaleString("es-ES",{month:"long"})},t+1))})]}),e.jsxs("div",{className:"col-md-2 text-center",children:[e.jsx("label",{htmlFor:"yearFilter",className:"form-label",children:"Filtrar por año:"}),e.jsxs("select",{id:"yearFilter",className:"form-select",value:v,onChange:s=>M(parseInt(s.target.value)),children:[e.jsx("option",{value:S,children:S}),e.jsx("option",{value:S+1,children:S+1})]})]})]}),e.jsxs("h3",{className:"mb-3",children:["Gastos de Tarjeta de Crédito -"," ",new Date(0,g-1).toLocaleString("es-ES",{month:"long"})," ",v]}),e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Detalle"}),e.jsx("th",{children:"Monto (Pesos)"}),e.jsx("th",{children:"Monto (Dólares)"}),e.jsx("th",{children:"Cuotas Restantes"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:A.map(s=>{const t=s.amountInPesos/s.installments,a=s.amountInDollars?s.amountInDollars/s.installments:0;return e.jsxs("tr",{children:[e.jsx("td",{children:s.date}),e.jsx("td",{children:s.transactionDetail}),e.jsxs("td",{children:["$",t.toFixed(2)]}),e.jsxs("td",{children:["$",a.toFixed(2)]}),e.jsx("td",{children:s.installments}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>U(s.id),children:"Eliminar"})})]},s.id)})})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsxs("h4",{children:["Total a pagar en"," ",new Date(0,g-1).toLocaleString("es-ES",{month:"long"})," ",v,": $",O.toFixed(2)]})})]})},xe=()=>{const[d,i]=r.useState(null),u=B();r.useEffect(()=>{const n=H(E,l=>{i(l)});return()=>n()},[]);const x=async()=>{try{await W(E),u("/")}catch(n){console.error("Error al cerrar sesión: ",n)}};return d?e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"10px"},children:[d.photoURL&&e.jsx("img",{src:d.photoURL,alt:"User Avatar",style:{width:40,height:40,borderRadius:"50%",marginRight:10}}),e.jsx("span",{children:d.displayName}),e.jsx("button",{className:"btn btn-danger btn-sm ms-3",onClick:x,children:"Cerrar Sesión"})]}):null},k=({children:d})=>{const[i,u]=r.useState(null),[x,n]=r.useState(!0);return r.useEffect(()=>{const l=H(E,p=>{u(p),n(!1)});return()=>l()},[]),x?null:i?e.jsx(e.Fragment,{children:d}):e.jsx(oe,{to:"/"})},je=()=>{const d=i=>{console.log("Totales actualizados:",i)};return r.useEffect(()=>{const i=()=>{navigator.sendBeacon("/signout",JSON.stringify({user:E.currentUser})),W(E).catch(u=>console.error("Error al desloguearse:",u))};return window.addEventListener("unload",i),()=>{window.removeEventListener("unload",i)}},[]),e.jsx(Z,{children:e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(xe,{}),e.jsx("h1",{className:"d-flex justify-content-center align-items-center",children:"Gastos Hidalgo Voos"}),e.jsxs(re,{children:[e.jsx($,{path:"/",element:e.jsx(ie,{})}),e.jsx($,{path:"/expenses",element:e.jsx(k,{children:e.jsxs(e.Fragment,{children:[e.jsx(de,{}),e.jsx(ue,{})]})})}),e.jsx($,{path:"/credit-expenses",element:e.jsx(k,{children:e.jsx(he,{onTotalsUpdate:d})})})]})]})})};X(document.getElementById("root")).render(e.jsx(r.StrictMode,{children:e.jsx(je,{})}));
