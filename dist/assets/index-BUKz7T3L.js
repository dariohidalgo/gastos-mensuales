import{j as e,r as a}from"./react-CtW5r0F0.js";import{c as te}from"./react-dom-CoD-mNjq.js";import{B as se}from"./react-router-dom-CSK1S-1I.js";import"./firebase-SmtNWdoZ.js";import{i as ne,g as ae,a as re,G as oe,s as le,o as J,q as B,c as q,b as z,T as K,d as W,e as _,f as Q,h as X}from"./@firebase-DgOjqIHO.js";import{u as V,a as ce,b as k,N as ie}from"./react-router-DZm7uZHo.js";/* empty css                  */import"./scheduler-CzFDRTuY.js";import"./@remix-run-C0MJ9PeH.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))x(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const g of r.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&x(g)}).observe(document,{childList:!0,subtree:!0});function u(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function x(n){if(n.ep)return;n.ep=!0;const r=u(n);fetch(n.href,r)}})();const de={apiKey:"AIzaSyCqkgutqaofo2LOGpNnAurawoP21IrMicY",authDomain:"gastos-66dbe.firebaseapp.com",projectId:"gastos-66dbe",storageBucket:"gastos-66dbe.appspot.com",messagingSenderId:"1092119604551",appId:"1:1092119604551:web:032ce6a8cb110fec04f062"},Z=ne(de),C=ae(Z),E=re(Z),me=new oe,ue=()=>{const i=V(),l=async()=>{try{const x=(await le(C,me)).user;x&&["dhidalgo651@gmail.com","voosdani@gmail.com"].includes(x.email)?i("/expenses"):(alert("Correo electrónico no autorizado."),C.signOut())}catch(u){console.error("Error durante el inicio de sesión:",u),alert("Error durante el inicio de sesión. Por favor, inténtalo de nuevo.")}};return e.jsx("div",{className:"login d-flex justify-content-center align-items-center vh-100",children:e.jsxs("div",{className:"col-10 col-sm-8 col-md-6 col-lg-4 d-flex flex-column align-items-center",children:[e.jsx("h2",{className:"titulo mb-4 text-center",children:"Bienvenido a la Aplicación de Gastos"}),e.jsx("button",{className:"btn btn-primary",onClick:l,children:"Iniciar sesión con Google"})]})})},he=()=>e.jsx("div",{className:"container d-flex justify-content-center",children:e.jsx("div",{className:" justify-content-md-end mt-3",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>window.location.href="/credit-expenses",children:"Ver Gastos de Tarjeta"})})}),xe=(i,l,u)=>i.flatMap(n=>{const r=new Date(n.date),g=r.getMonth()+1,M=r.getFullYear(),y=(u-M)*12+(l-(g+1));return y>=0&&y<n.installments?n.amountInPesos/n.installments:0}).reduce((n,r)=>n+r,0),pe=()=>{const[i,l]=a.useState([]),[u,x]=a.useState([]),[n,r]=a.useState([]),[g,M]=a.useState(0),[y,Y]=a.useState(0),[A,G]=a.useState(0),[F,I]=a.useState(""),[b]=a.useState(new Date().getFullYear()),[U,S]=a.useState(""),[P,w]=a.useState("Ingresos"),[T,L]=a.useState(""),[D,R]=a.useState(""),[O,$]=a.useState(""),[t,o]=a.useState("");a.useEffect(()=>{const s=async()=>{const p=B(q(E,"expenses")),m=(await z(p)).docs.map(j=>{const f=j.data(),ee=f.createdAt instanceof K?f.createdAt.toDate():new Date;return{id:j.id,amount:f.amount,type:f.type,category:f.category,description:f.description||"",installments:f.installments,createdAt:ee,userName:f.userName||""}});l(m)},d=async()=>{const p=B(q(E,"creditCardExpenses")),m=(await z(p)).docs.map(j=>{const f=j.data();return{id:j.id,...f}});r(m)};s(),d()},[]),a.useEffect(()=>{if(F){const s=i.filter(m=>{const j=m.createdAt.getMonth()+1,f=m.createdAt.getFullYear();return j===parseInt(F)&&f===new Date().getFullYear()}),d=s.filter(m=>m.type==="Ingresos").reduce((m,j)=>m+j.amount,0),p=s.filter(m=>m.type==="Gastos").reduce((m,j)=>m+j.amount,0),N=xe(n,parseInt(F),b);x(s),M(d),Y(N),G(p)}else x(i)},[F,b,i,n]),a.useEffect(()=>{const s=J(C,d=>{o(d?d.displayName||"Usuario Actual":"")});return()=>s()},[]);const c=s=>{const d=s.target.value;I(d)},h=async s=>{s.preventDefault();try{await W(q(E,"expenses"),{amount:parseFloat(U),type:P,category:T,description:D,createdAt:new Date(O),userName:t,installments:P==="Tarjeta de Credito"?1:0}),S(""),w("Ingresos"),L(""),R(""),$("");const d=B(q(E,"expenses")),N=(await z(d)).docs.map(m=>{const j=m.data(),f=j.createdAt instanceof K?j.createdAt.toDate():new Date;return{id:m.id,...j,createdAt:f}});l(N)}catch(d){console.error("Error al agregar el gasto: ",d)}},v=async s=>{if(window.confirm("Are you sure you want to delete this expense?"))try{await _(Q(E,"expenses",s)),l(p=>p.filter(N=>N.id!==s))}catch(p){console.error("Error deleting document: ",p)}};return e.jsxs("div",{className:"container mt-4",children:[e.jsxs("form",{onSubmit:h,className:"row mb-4",children:[e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"number",className:"form-control",placeholder:"Monto",value:U,onChange:s=>S(s.target.value),required:!0})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:P,onChange:s=>w(s.target.value),children:[e.jsx("option",{value:"Ingresos",children:"Ingresos"}),e.jsx("option",{value:"Tarjeta de Credito",children:"Tarjeta de Crédito"}),e.jsx("option",{value:"Gastos",children:"Gastos"})]})}),e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Categoría",value:T,onChange:s=>L(s.target.value),required:!0})}),e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Descripción",value:D,onChange:s=>R(s.target.value)})}),e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"date",className:"form-control",value:O,onChange:s=>$(s.target.value),required:!0})}),e.jsx("div",{className:"col-md-2",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Agregar Gasto"})})]}),e.jsx("div",{className:"row mb-4 d-flex justify-content-center",children:e.jsxs("div",{className:"col-md-3 text-center",children:[e.jsx("label",{htmlFor:"monthFilter",className:"form-label",children:"Filtrar por mes:"}),e.jsxs("select",{id:"monthFilter",className:"form-select",value:F,onChange:c,children:[e.jsx("option",{value:"",children:"Todos los meses"}),e.jsx("option",{value:"1",children:"Enero"}),e.jsx("option",{value:"2",children:"Febrero"}),e.jsx("option",{value:"3",children:"Marzo"}),e.jsx("option",{value:"4",children:"Abril"}),e.jsx("option",{value:"5",children:"Mayo"}),e.jsx("option",{value:"6",children:"Junio"}),e.jsx("option",{value:"7",children:"Julio"}),e.jsx("option",{value:"8",children:"Agosto"}),e.jsx("option",{value:"9",children:"Septiembre"}),e.jsx("option",{value:"10",children:"Octubre"}),e.jsx("option",{value:"11",children:"Noviembre"}),e.jsx("option",{value:"12",children:"Diciembre"})]})]})}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card text-center",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Total de Ingresos"}),e.jsxs("p",{className:"card-text",children:["$",g.toLocaleString("es-ES")]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card text-center",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Deuda total de tarjeta de crédito"}),e.jsxs("p",{className:"card-text",children:["$",y.toLocaleString("es-ES")]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card text-center",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Gastos fijos totales"}),e.jsxs("p",{className:"card-text",children:["$",A.toLocaleString("es-ES")]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card text-center",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Monto restante"}),e.jsxs("p",{className:"card-text",children:["$",(g-y-A).toLocaleString("es-ES")]})]})})})]}),e.jsx("h3",{className:"mb-3",children:"Todas las transacciones:"}),e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Monto"}),e.jsx("th",{children:"Categoría"}),e.jsx("th",{children:"Descripción"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Usuario"}),e.jsx("th",{children:"Cuotas"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:u.map((s,d)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.type==="Tarjeta de Credito"?"Tarjeta de crédito":s.type==="Gastos"?"Gasto":"Ingreso"}),e.jsxs("td",{children:["$",s.amount.toLocaleString("es-ES")]}),e.jsx("td",{children:s.category}),e.jsx("td",{children:s.description}),e.jsx("td",{children:s.createdAt.toLocaleDateString()}),e.jsx("td",{children:s.userName?s.userName:"Usuario Desconocido"}),e.jsx("td",{children:s.type==="Tarjeta de Credito"?s.installments:"-"}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>v(s.id),children:"Eliminar"})})]},d))})]})]})},je=({onTotalsUpdate:i})=>{const l=V(),[u,x]=a.useState(""),[n,r]=a.useState(""),[g,M]=a.useState(""),[y,Y]=a.useState(""),[A,G]=a.useState(1),F=new Date().getMonth(),I=new Date().getFullYear(),[b,U]=a.useState(F+1),[S,P]=a.useState(I),[w,T]=a.useState([]),[L,D]=a.useState([]);a.useEffect(()=>{(async()=>{const o=B(q(E,"creditCardExpenses")),h=(await z(o)).docs.map(v=>{const s=v.data();return{id:v.id,...s}});T(h),D(h)})()},[]);const R=async t=>{t.preventDefault();try{const c={id:(await W(q(E,"creditCardExpenses"),{date:u,transactionDetail:n,amountInPesos:parseFloat(g),amountInDollars:parseFloat(y)||0,installments:A})).id,date:u,transactionDetail:n,amountInPesos:parseFloat(g),amountInDollars:parseFloat(y)||0,installments:A};T(h=>[...h,c]),D(h=>[...h,c]),x(""),r(""),M(""),Y(""),G(1)}catch(o){console.error("Error al agregar el gasto: ",o)}};a.useEffect(()=>{if(b&&S){const o=w.flatMap(c=>{const h=new Date(c.date),v=h.getMonth()+1,s=h.getFullYear(),d=b,p=S;if(isNaN(d)||isNaN(v))return console.error("Error: Mes seleccionado o índice de mes es NaN"),[];const N=(p-s)*12+(d-(v+1));if(N>=0&&N<c.installments){const m=c.installments-N;return{...c,remainingInstallments:m}}else return[]});D(o)}else D(w);const t={};w.forEach(o=>{const c=new Date(o.date),h=o.amountInPesos/o.installments;for(let v=0;v<o.installments;v++){const s=(c.getMonth()+v+1)%12,p=`${c.getFullYear()+Math.floor((c.getMonth()+v+1)/12)}-${(s||12).toString().padStart(2,"0")}`;t[p]||(t[p]=0),t[p]+=h}}),i(t)},[b,S,w]);const O=async t=>{if(!(!t||!window.confirm("¿Estás seguro de que deseas eliminar este gasto?")))try{await _(Q(E,"creditCardExpenses",t)),T(c=>c.filter(h=>h.id!==t)),D(c=>c.filter(h=>h.id!==t))}catch(c){console.error("Error al eliminar el gasto: ",c)}},$=L.reduce((t,o)=>t+o.amountInPesos/o.installments,0);return e.jsxs("div",{className:"container",children:[e.jsxs("form",{className:"row justify-content-center align-items-center m-3",onSubmit:R,children:[e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"date",children:"Fecha:"}),e.jsx("input",{className:"form-control",type:"date",id:"date",value:u,onChange:t=>x(t.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"mb-2",htmlFor:"transactionDetail",children:"Detalle de Transacción:"}),e.jsx("input",{className:"form-control",type:"text",id:"transactionDetail",placeholder:"Detalle",value:n,onChange:t=>r(t.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"amountInPesos",children:"Monto en Pesos:"}),e.jsx("input",{className:"form-control",type:"number",id:"amountInPesos",placeholder:"Pesos",value:g,onChange:t=>M(t.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"amountInDollars",children:"Monto en Dólares:"}),e.jsx("input",{className:"form-control",type:"number",id:"amountInDollars",placeholder:"Dólares",value:y,onChange:t=>Y(t.target.value)})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"installments",children:"Cuotas:"}),e.jsx("input",{className:"form-control",type:"number",id:"installments",min:"1",value:A,onChange:t=>G(parseInt(t.target.value)),required:!0})]}),e.jsx("div",{className:"col-md-2 d-flex justify-content-center mt-3",children:e.jsx("button",{className:"btn btn-success btn-lg",type:"submit",children:"Enviar"})}),e.jsx("div",{className:"col-md-2 d-flex justify-content-center mt-3",children:e.jsx("button",{className:"btn btn-primary btn-lg",onClick:()=>l("/expenses"),children:"Volver"})})]}),e.jsxs("div",{className:"row mb-4 d-flex justify-content-center",children:[e.jsxs("div",{className:"col-md-2 text-center",children:[e.jsx("label",{htmlFor:"monthFilter",className:"form-label",children:"Filtrar por mes:"}),e.jsx("select",{id:"monthFilter",className:"form-select",value:b,onChange:t=>U(parseInt(t.target.value)),children:[...Array(12)].map((t,o)=>e.jsx("option",{value:o+1,children:new Date(0,o).toLocaleString("es-ES",{month:"long"})},o+1))})]}),e.jsxs("div",{className:"col-md-2 text-center",children:[e.jsx("label",{htmlFor:"yearFilter",className:"form-label",children:"Filtrar por año:"}),e.jsxs("select",{id:"yearFilter",className:"form-select",value:S,onChange:t=>P(parseInt(t.target.value)),children:[e.jsx("option",{value:I,children:I}),e.jsx("option",{value:I+1,children:I+1})]})]})]}),e.jsxs("h3",{className:"mb-3",children:["Gastos de Tarjeta de Crédito -"," ",new Date(0,b-1).toLocaleString("es-ES",{month:"long"})," ",S]}),e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Detalle"}),e.jsx("th",{children:"Monto (Pesos)"}),e.jsx("th",{children:"Monto (Dólares)"}),e.jsx("th",{children:"Cuotas Restantes"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:L.map(t=>{const o=t.amountInPesos/t.installments,c=t.amountInDollars?t.amountInDollars/t.installments:0;return e.jsxs("tr",{children:[e.jsx("td",{children:t.date}),e.jsx("td",{children:t.transactionDetail}),e.jsxs("td",{children:["$",o.toFixed(2)]}),e.jsxs("td",{children:["$",c.toFixed(2)]}),e.jsx("td",{children:t.installments}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>O(t.id),children:"Eliminar"})})]},t.id)})})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsxs("h4",{children:["Total a pagar en"," ",new Date(0,b-1).toLocaleString("es-ES",{month:"long"})," ",S,": $",$.toFixed(2)]})})]})},ge=()=>{const[i,l]=a.useState(null),u=V();a.useEffect(()=>{const n=J(C,r=>{l(r)});return()=>n()},[]);const x=async()=>{try{await X(C),u("/")}catch(n){console.error("Error al cerrar sesión: ",n)}};return i?e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"10px"},children:[i.photoURL&&e.jsx("img",{src:i.photoURL,alt:"User Avatar",style:{width:40,height:40,borderRadius:"50%",marginRight:10}}),e.jsx("span",{children:i.displayName}),e.jsx("button",{className:"btn btn-danger btn-sm ms-3",onClick:x,children:"Cerrar Sesión"})]}):null},H=({children:i})=>{const[l,u]=a.useState(null),[x,n]=a.useState(!0);return a.useEffect(()=>{const r=J(C,g=>{u(g),n(!1)});return()=>r()},[]),x?null:l?e.jsx(e.Fragment,{children:i}):e.jsx(ie,{to:"/"})},fe=()=>{const i=l=>{console.log("Totales actualizados:",l)};return a.useEffect(()=>{const l=()=>{navigator.sendBeacon("/signout",JSON.stringify({user:C.currentUser})),X(C).catch(u=>console.error("Error al desloguearse:",u))};return window.addEventListener("unload",l),()=>{window.removeEventListener("unload",l)}},[]),e.jsx(se,{children:e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(ge,{}),e.jsx("h1",{className:"d-flex justify-content-center align-items-center",children:"Gastos Hidalgo Voos"}),e.jsxs(ce,{children:[e.jsx(k,{path:"/",element:e.jsx(ue,{})}),e.jsx(k,{path:"/expenses",element:e.jsx(H,{children:e.jsxs(e.Fragment,{children:[e.jsx(he,{}),e.jsx(pe,{})]})})}),e.jsx(k,{path:"/credit-expenses",element:e.jsx(H,{children:e.jsx(je,{onTotalsUpdate:i})})})]})]})})};te(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(fe,{})}));
