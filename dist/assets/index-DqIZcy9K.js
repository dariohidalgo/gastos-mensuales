import{j as e,r as a}from"./react-CtW5r0F0.js";import{c as ce}from"./react-dom-CoD-mNjq.js";import{B as ie}from"./react-router-dom-CSK1S-1I.js";import"./firebase-B_-rUrOV.js";import{i as de,g as me,a as ue,G as he,s as xe,o as X,q as Q,c as Y,b as _,T as ee,d as ne,e as H,u as te,f as ae,h as re}from"./@firebase-BI60QZOY.js";import{u as Z,a as pe,b as W,N as je}from"./react-router-DZm7uZHo.js";/* empty css                  */import"./scheduler-CzFDRTuY.js";import"./@remix-run-C0MJ9PeH.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))p(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const f of r.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&p(f)}).observe(document,{childList:!0,subtree:!0});function u(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function p(n){if(n.ep)return;n.ep=!0;const r=u(n);fetch(n.href,r)}})();const ge={apiKey:"AIzaSyCqkgutqaofo2LOGpNnAurawoP21IrMicY",authDomain:"gastos-66dbe.firebaseapp.com",projectId:"gastos-66dbe",storageBucket:"gastos-66dbe.appspot.com",messagingSenderId:"1092119604551",appId:"1:1092119604551:web:032ce6a8cb110fec04f062"},oe=de(ge),C=me(oe),N=ue(oe),fe=new he,be=()=>{const m=Z(),c=async()=>{try{const p=(await xe(C,fe)).user;p&&["dhidalgo651@gmail.com","voosdani@gmail.com"].includes(p.email)?m("/expenses"):(alert("Correo electrónico no autorizado."),C.signOut())}catch(u){console.error("Error durante el inicio de sesión:",u),alert("Error durante el inicio de sesión. Por favor, inténtalo de nuevo.")}};return e.jsx("div",{className:"login d-flex justify-content-center align-items-center vh-100",children:e.jsxs("div",{className:"col-10 col-sm-8 col-md-6 col-lg-4 d-flex flex-column align-items-center",children:[e.jsx("h2",{className:"titulo mb-4 text-center",children:"Bienvenido a la Aplicación de Gastos"}),e.jsx("button",{className:"btn btn-primary",onClick:c,children:"Iniciar sesión con Google"})]})})},ye=()=>e.jsx("div",{className:"container d-flex justify-content-center",children:e.jsx("div",{className:" justify-content-md-end mt-3",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>window.location.href="/credit-expenses",children:"Ver Gastos de Tarjeta"})})}),O=m=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:2}).format(m),ve=(m,c,u)=>m.flatMap(n=>{const r=new Date(n.date),f=r.getMonth()+1,P=r.getFullYear(),E=(u-P)*12+(c-(f+1));return E>=0&&E<n.installments?n.amountInPesos/n.installments:0}).reduce((n,r)=>n+r,0),Ne=()=>{const[m,c]=a.useState([]),[u,p]=a.useState([]),[n,r]=a.useState([]),[f,P]=a.useState(0),[E,B]=a.useState(0),[q,$]=a.useState(0),[w,I]=a.useState((new Date().getMonth()+1).toString()),[S]=a.useState(new Date().getFullYear()),[T,v]=a.useState(""),[R,F]=a.useState("Ingresos"),[L,G]=a.useState(""),[D,z]=a.useState(""),[V,K]=a.useState(""),[s,i]=a.useState(""),[d,h]=a.useState(null);a.useEffect(()=>{const t=async()=>{const x=Q(Y(N,"expenses")),l=(await _(x)).docs.map(j=>{const g=j.data(),le=g.createdAt instanceof ee?g.createdAt.toDate():new Date;return{id:j.id,amount:g.amount,type:g.type,category:g.category,description:g.description||"",installments:g.installments,createdAt:le,userName:g.userName||"",paid:g.paid||!1}});c(l)},o=async()=>{const x=Q(Y(N,"creditCardExpenses")),l=(await _(x)).docs.map(j=>{const g=j.data();return{id:j.id,...g}});r(l)};t(),o()},[]),a.useEffect(()=>{if(w){const t=m.filter(l=>{const j=l.createdAt.getMonth()+1,g=l.createdAt.getFullYear();return j===parseInt(w)&&g===new Date().getFullYear()}),o=t.filter(l=>l.type==="Ingresos").reduce((l,j)=>l+j.amount,0),x=t.filter(l=>l.type==="Gastos").reduce((l,j)=>l+j.amount,0),y=ve(n,parseInt(w),S);p(t),P(o),B(y),$(x)}else p(m)},[w,S,m,n]),a.useEffect(()=>{const t=X(C,o=>{i(o?o.displayName||"Usuario Actual":"")});return()=>t()},[]);const b=t=>{const o=t.target.value;I(o)},M=async t=>{t.preventDefault();try{await ne(Y(N,"expenses"),{amount:parseFloat(T),type:R,category:L,description:D,createdAt:new Date(V),userName:s,installments:R==="Tarjeta de Credito"?1:0}),v(""),F("Ingresos"),G(""),z(""),K("");const o=Q(Y(N,"expenses")),y=(await _(o)).docs.map(l=>{const j=l.data(),g=j.createdAt instanceof ee?j.createdAt.toDate():new Date;return{id:l.id,...j,createdAt:g}});c(y)}catch(o){console.error("Error al agregar el gasto: ",o)}},U=async t=>{h(t)},A=async(t,o)=>{try{const x=H(N,"expenses",t);await te(x,{amount:parseFloat(o)}),c(y=>y.map(l=>l.id===t?{...l,amount:parseFloat(o)}:l)),h(null)}catch(x){console.error("Error updating expense: ",x)}},k=async t=>{if(window.confirm("Are you sure you want to delete this expense?"))try{await ae(H(N,"expenses",t)),c(x=>x.filter(y=>y.id!==t))}catch(x){console.error("Error deleting document: ",x)}},J=async(t,o)=>{try{const x=H(N,"expenses",t);await te(x,{paid:!o}),c(y=>y.map(l=>l.id===t?{...l,paid:!o}:l))}catch(x){console.error("Error updating expense: ",x)}};return e.jsxs("div",{className:"container mt-4",children:[e.jsxs("form",{onSubmit:M,className:"row mb-4",children:[e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"number",className:"form-control",placeholder:"Monto",value:T,onChange:t=>v(t.target.value),required:!0})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:R,onChange:t=>F(t.target.value),children:[e.jsx("option",{value:"Ingresos",children:"Ingresos"}),e.jsx("option",{value:"Tarjeta de Credito",children:"Tarjeta de Crédito"}),e.jsx("option",{value:"Gastos",children:"Gastos"})]})}),e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Categoría",value:L,onChange:t=>G(t.target.value)})}),e.jsx("div",{className:"col-md-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Descripción",value:D,onChange:t=>z(t.target.value)})}),e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"date",className:"form-control",value:V,onChange:t=>K(t.target.value),required:!0})}),e.jsx("div",{className:"col-md-1",children:e.jsx("button",{type:"submit",className:"btn btn-primary w-100 mt-2",children:"Agregar"})})]}),e.jsx("div",{className:"text-center mb-4",children:e.jsxs("select",{className:"form-select w-auto d-inline-block",value:w,onChange:b,children:[e.jsx("option",{value:"",children:"Seleccionar mes"}),Array.from({length:12},(t,o)=>e.jsx("option",{value:o+1,children:new Date(0,o).toLocaleString("default",{month:"long"})},o+1))]})}),e.jsxs("div",{className:"row text-center",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card text-white bg-primary mb-3",children:[e.jsx("div",{className:"card-header",children:"Total Ingresos"}),e.jsx("div",{className:"card-body",children:e.jsx("h5",{className:"card-title",children:O(f)})})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card text-white bg-danger mb-3",children:[e.jsx("div",{className:"card-header",children:"Total Gastos Fijos"}),e.jsx("div",{className:"card-body",children:e.jsx("h5",{className:"card-title",children:O(q)})})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card text-white bg-warning mb-3",children:[e.jsx("div",{className:"card-header",children:"Total Tarjeta de Crédito"}),e.jsx("div",{className:"card-body",children:e.jsx("h5",{className:"card-title",children:O(E)})})]})}),e.jsx("div",{className:"col-md-4 mx-auto",children:e.jsxs("div",{className:"card text-white bg-success mb-3 ",children:[e.jsx("div",{className:"card-header",children:"Lo Que Queda"}),e.jsx("div",{className:"card-body",children:e.jsx("h5",{className:"card-title",children:O(f-(q+E))})})]})})]}),e.jsx("div",{className:"row ",children:e.jsxs("div",{className:"col-md-12 bg-dark",children:[e.jsx("h4",{children:"Lista de Gastos"}),e.jsxs("table",{className:"table table-striped table-dark",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Descripción"}),e.jsx("th",{children:"Monto"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Categoría"}),e.jsx("th",{children:"Pagado"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:u.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.createdAt.toLocaleDateString()}),e.jsx("td",{children:t.description}),e.jsx("td",{children:d===t.id?e.jsx("input",{type:"number",value:T,onChange:o=>v(o.target.value)}):O(t.amount)}),e.jsx("td",{children:t.type}),e.jsx("td",{children:t.category}),e.jsx("td",{children:t.type!=="Ingresos"&&e.jsx("input",{type:"checkbox",checked:!!t.paid,onChange:()=>J(t.id,!!t.paid)})}),e.jsxs("td",{children:[d===t.id?e.jsx("button",{className:"btn btn-success btn-sm",onClick:()=>A(t.id,T),children:"Guardar"}):e.jsx("button",{className:"btn btn-warning btn-sm",onClick:()=>U(t.id),children:"Editar"}),e.jsx("button",{className:"btn btn-danger btn-sm ms-2",onClick:()=>k(t.id),children:"Eliminar"})]})]},t.id))})]})]})})]})},Ee=({onTotalsUpdate:m})=>{const c=Z(),[u,p]=a.useState(""),[n,r]=a.useState(""),[f,P]=a.useState(""),[E,B]=a.useState(""),[q,$]=a.useState(1),w=new Date().getMonth(),I=new Date().getFullYear(),[S,T]=a.useState(w+1),[v,R]=a.useState(I),[F,L]=a.useState([]),[G,D]=a.useState([]);a.useEffect(()=>{(async()=>{const i=Q(Y(N,"creditCardExpenses")),h=(await _(i)).docs.map(b=>{const M=b.data();return{id:b.id,...M}});L(h),D(h)})()},[]);const z=async s=>{s.preventDefault();try{const d={id:(await ne(Y(N,"creditCardExpenses"),{date:u,transactionDetail:n,amountInPesos:parseFloat(f),amountInDollars:parseFloat(E)||0,installments:q})).id,date:u,transactionDetail:n,amountInPesos:parseFloat(f),amountInDollars:parseFloat(E)||0,installments:q};L(h=>[...h,d]),D(h=>[...h,d]),p(""),r(""),P(""),B(""),$(1)}catch(i){console.error("Error al agregar el gasto: ",i)}};a.useEffect(()=>{if(S&&v){const i=F.flatMap(d=>{const h=new Date(d.date),b=h.getMonth()+1,M=h.getFullYear(),U=S,A=v;if(isNaN(U)||isNaN(b))return console.error("Error: Mes seleccionado o índice de mes es NaN"),[];const k=(A-M)*12+(U-(b+1));if(k>=0&&k<d.installments){const J=d.installments-k;return{...d,remainingInstallments:J}}else return[]});D(i)}else D(F);const s={};F.forEach(i=>{const d=new Date(i.date),h=i.amountInPesos/i.installments;for(let b=0;b<i.installments;b++){const M=(d.getMonth()+b+1)%12,A=`${d.getFullYear()+Math.floor((d.getMonth()+b+1)/12)}-${(M||12).toString().padStart(2,"0")}`;s[A]||(s[A]=0),s[A]+=h}}),m(s)},[S,v,F]);const V=async s=>{if(!(!s||!window.confirm("¿Estás seguro de que deseas eliminar este gasto?")))try{await ae(H(N,"creditCardExpenses",s)),L(d=>d.filter(h=>h.id!==s)),D(d=>d.filter(h=>h.id!==s))}catch(d){console.error("Error al eliminar el gasto: ",d)}},K=G.reduce((s,i)=>s+i.amountInPesos/i.installments,0);return e.jsxs("div",{className:"container",children:[e.jsxs("form",{className:"row justify-content-center align-items-center m-3",onSubmit:z,children:[e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"date",children:"Fecha:"}),e.jsx("input",{className:"form-control",type:"date",id:"date",value:u,onChange:s=>p(s.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"mb-2",htmlFor:"transactionDetail",children:"Detalle de Transacción:"}),e.jsx("input",{className:"form-control",type:"text",id:"transactionDetail",placeholder:"Detalle",value:n,onChange:s=>r(s.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"amountInPesos",children:"Monto en Pesos:"}),e.jsx("input",{className:"form-control",type:"number",id:"amountInPesos",placeholder:"Pesos",value:f,onChange:s=>P(s.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"amountInDollars",children:"Monto en Dólares:"}),e.jsx("input",{className:"form-control",type:"number",id:"amountInDollars",placeholder:"Dólares",value:E,onChange:s=>B(s.target.value)})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"mb-2",htmlFor:"installments",children:"Cuotas:"}),e.jsx("input",{className:"form-control",type:"number",id:"installments",min:"1",value:q,onChange:s=>$(parseInt(s.target.value)),required:!0})]}),e.jsx("div",{className:"col-md-2 d-flex justify-content-center mt-3",children:e.jsx("button",{className:"btn btn-success btn-lg",type:"submit",children:"Enviar"})}),e.jsx("div",{className:"col-md-2 d-flex justify-content-center mt-3",children:e.jsx("button",{className:"btn btn-primary btn-lg",onClick:()=>c("/expenses"),children:"Volver"})})]}),e.jsxs("div",{className:"row mb-4 d-flex justify-content-center",children:[e.jsxs("div",{className:"col-md-2 text-center",children:[e.jsx("label",{htmlFor:"monthFilter",className:"form-label",children:"Filtrar por mes:"}),e.jsx("select",{id:"monthFilter",className:"form-select",value:S,onChange:s=>T(parseInt(s.target.value)),children:[...Array(12)].map((s,i)=>e.jsx("option",{value:i+1,children:new Date(0,i).toLocaleString("es-ES",{month:"long"})},i+1))})]}),e.jsxs("div",{className:"col-md-2 text-center",children:[e.jsx("label",{htmlFor:"yearFilter",className:"form-label",children:"Filtrar por año:"}),e.jsxs("select",{id:"yearFilter",className:"form-select",value:v,onChange:s=>R(parseInt(s.target.value)),children:[e.jsx("option",{value:I,children:I}),e.jsx("option",{value:I+1,children:I+1})]})]})]}),e.jsxs("h3",{className:"mb-3",children:["Gastos de Tarjeta de Crédito -"," ",new Date(0,S-1).toLocaleString("es-ES",{month:"long"})," ",v]}),e.jsxs("table",{className:"table table-striped table-dark",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Detalle"}),e.jsx("th",{children:"Monto (Pesos)"}),e.jsx("th",{children:"Monto (Dólares)"}),e.jsx("th",{children:"Cuotas Restantes"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:G.map(s=>{const i=s.amountInPesos/s.installments,d=s.amountInDollars?s.amountInDollars/s.installments:0;return e.jsxs("tr",{children:[e.jsx("td",{children:s.date}),e.jsx("td",{children:s.transactionDetail}),e.jsxs("td",{children:["$",i.toFixed(2)]}),e.jsxs("td",{children:["$",d.toFixed(2)]}),e.jsx("td",{children:s.installments}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>V(s.id),children:"Eliminar"})})]},s.id)})})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsxs("h4",{children:["Total a pagar en"," ",new Date(0,S-1).toLocaleString("es-ES",{month:"long"})," ",v,": $",K.toFixed(2)]})})]})},Se=()=>{const[m,c]=a.useState(null),u=Z();a.useEffect(()=>{const n=X(C,r=>{c(r)});return()=>n()},[]);const p=async()=>{try{await re(C),u("/")}catch(n){console.error("Error al cerrar sesión: ",n)}};return m?e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"10px"},children:[m.photoURL&&e.jsx("img",{src:m.photoURL,alt:"User Avatar",style:{width:40,height:40,borderRadius:"50%",marginRight:10}}),e.jsx("span",{children:m.displayName}),e.jsx("button",{className:"btn btn-danger btn-sm ms-3",onClick:p,children:"Cerrar Sesión"})]}):null},se=({children:m})=>{const[c,u]=a.useState(null),[p,n]=a.useState(!0);return a.useEffect(()=>{const r=X(C,f=>{u(f),n(!1)});return()=>r()},[]),p?null:c?e.jsx(e.Fragment,{children:m}):e.jsx(je,{to:"/"})},De=()=>{const m=c=>{console.log("Totales actualizados:",c)};return a.useEffect(()=>{const c=()=>{navigator.sendBeacon("/signout",JSON.stringify({user:C.currentUser})),re(C).catch(u=>console.error("Error al desloguearse:",u))};return window.addEventListener("unload",c),()=>{window.removeEventListener("unload",c)}},[]),e.jsx(ie,{children:e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(Se,{}),e.jsx("h1",{className:"d-flex justify-content-center align-items-center",children:"Gastos Hidalgo Voos"}),e.jsxs(pe,{children:[e.jsx(W,{path:"/",element:e.jsx(be,{})}),e.jsx(W,{path:"/expenses",element:e.jsx(se,{children:e.jsxs(e.Fragment,{children:[e.jsx(ye,{}),e.jsx(Ne,{})]})})}),e.jsx(W,{path:"/credit-expenses",element:e.jsx(se,{children:e.jsx(Ee,{onTotalsUpdate:m})})})]})]})})};ce(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(De,{})}));
